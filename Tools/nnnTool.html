<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§æ–‡æœ¬æ ¼å¼åŒ–å·¥å…· - å®æ—¶ç‰ˆ</title>
    <style>
        /* --- åŸºç¡€å˜é‡ä¸é‡ç½® (å¤§æ°”ç®€çº¦é£æ ¼) --- */
        :root {
            --primary: #3366ff;       
            --primary-hover: #1f50e0;
            --bg-body: #f7f9fc;       
            --bg-card: #ffffff;
            --text-main: #2c3e50;     
            --text-sub: #7f8c8d;
            --border: #e9ecef;        
            --input-bg: #fdfefe;
            --radius: 8px;            
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05); 
            --height-textarea: 65vh;  
            --active-bg: #e6f0ff; /* é«˜äº®æŒ‰é’®èƒŒæ™¯ */
            --active-border: #a0c3ff; /* é«˜äº®æŒ‰é’®è¾¹æ¡† */
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center; padding: 30px;
        }

        /* --- å·¦å³å¸ƒå±€å®¹å™¨ --- */
        .container {
            width: 90%;
            max-width: 1400px;
            height: 90vh; 
            display: flex;
            gap: 25px;
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 30px;
        }

        /* --- å·¦å³åˆ†æ æ ·å¼ --- */
        .panel {
            flex: 1; 
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .header h1 { 
            font-size: 1.5rem; 
            margin: 0; 
            font-weight: 400; 
            text-align: left; 
            border-bottom: 1px solid var(--border); 
            padding-bottom: 15px; 
            margin-bottom: 15px;
            color: var(--text-main);
        }
        
        /* --- ç¼–è¾‘å™¨é€šç”¨æ ·å¼ --- */
        .editor-box { position: relative; display: flex; flex-direction: column; flex-grow: 1; }
        .label-text {
            font-size: 0.8rem; font-weight: 500; color: var(--text-sub); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 8px;
        }
        
        /* è¾“å…¥æ¡†ä¸é¢„è§ˆæ¡†çš„å…±æœ‰æ ·å¼ */
        .common-textarea-style {
            width: 100%; flex-grow: 1; height: var(--height-textarea);
            padding: 20px;
            border: 1px solid var(--border); background-color: var(--input-bg);
            border-radius: var(--radius);
            font-family: 'Consolas', 'Monaco', monospace; 
            font-size: 14px; line-height: 1.8; 
            color: var(--text-main); resize: none; overflow: auto; white-space: pre-wrap;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        textarea.common-textarea-style:focus {
            outline: none; background-color: #fff; border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(51, 102, 255, 0.1);
        }

        /* --- è¾“å‡ºåŒºåŸŸç‰¹æ®Šå¤„ç† --- */
        .output-container { position: relative; flex-grow: 1; }
        #outputText, #outputPreview {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            margin: 0; 
        }
        #outputPreview { display: none; background-color: #fff; border-color: transparent; }
        .output-container.preview-mode #outputPreview { display: block; }
        .output-container.preview-mode #outputText { visibility: hidden; }

        /* --- é¡¶éƒ¨å·¥å…·æ  (é¢œè‰²/è‰²å·/è½¬æ¢) --- */
        .top-toolbar {
            display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--border); margin-bottom: 15px;
        }
        .top-toolbar .separator {
            width: 1px; height: 24px; background-color: var(--border); margin: 0 5px;
        }
        .top-toolbar .flex-spacer {
            flex-grow: 1; 
        }


        /* --- æŒ‰é’®é€šç”¨æ ·å¼ --- */
        .btn {
            cursor: pointer; transition: all 0.2s; font-size: 0.85rem; font-weight: 500; border-radius: 6px; padding: 8px 15px;
            display: flex; align-items: center; gap: 5px; white-space: nowrap;
        }
        .btn-default { 
            background: #f1f3f5; 
            border: 1px solid var(--border); 
            color: var(--text-main); 
        }
        .btn-default:hover:not([disabled]) { 
            background-color: #e9ecef; 
            color: var(--primary);
        }
        /* --- æ¿€æ´»çš„é«˜äº®æ ·å¼ --- */
        .btn-active {
            background-color: var(--active-bg);
            border: 1px solid var(--active-border);
            color: var(--primary);
            font-weight: 600;
        }

        .btn-primary { 
            background-color: var(--primary); 
            border: 1px solid var(--primary); 
            color: #fff; 
        }
        .btn-primary:hover:not([disabled]) { 
            background-color: var(--primary-hover); 
        }
        .btn-disabled { opacity: 0.5; cursor: not-allowed !important; }

        /* --- é¢œè‰²é€‰æ‹©è¾“å…¥ç»„ --- */
        .color-group {
            display: flex; align-items: center; gap: 5px;
        }
        .color-group input[type="text"] {
            width: 75px; padding: 7px 8px; border: 1px solid var(--border); border-radius: 4px; font-family: monospace; font-size: 0.85rem;
        }
        .color-group input[type="color"] {
            width: 30px; height: 30px; padding: 0; border: none; background: none; cursor: pointer; border-radius: 4px; overflow: hidden;
        }

        /* --- Modal é¢œè‰²é€‰æ‹©å™¨ç¡®è®¤æ¡† --- */
        #colorConfirmModal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 1000;
            display: none; justify-content: center; align-items: center;
        }
        #colorConfirmModal.show { display: flex; }
        .modal-content {
            background: var(--bg-card); padding: 30px; border-radius: var(--radius); box-shadow: var(--shadow);
            display: flex; flex-direction: column; gap: 20px; min-width: 300px;
        }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; }


        /* --- Toast --- */
        #toast { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%) translateY(20px); background: #333; color: white; padding: 10px 20px; border-radius: 30px; font-size: 0.9rem; opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 10;}
        #toast.show { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
                height: auto;
                width: 95%;
            }
            .top-toolbar {
                flex-wrap: wrap;
                padding-bottom: 10px;
            }
            .common-textarea-style {
                height: 35vh; 
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="panel input-panel">
        <div class="header">
            <h1>è¾“å…¥é¢æ¿ (Input)</h1>
        </div>

        <div class="editor-box">
            <div class="top-toolbar">
                <div class="color-group">
                    <button id="btnColor" class="btn btn-default btn-disabled" disabled onclick="showColorModal()">
                        ğŸ¨ é¢œè‰²æ ‡ç­¾
                    </button>
                </div>
                
                <div class="separator"></div>

                <button class="btn btn-default" onclick="insertNewline()">
                    â†©ï¸ æ’å…¥ \n
                </button>

                <div class="separator"></div>
                
                <button id="btnToLiteral" class="btn btn-default" onclick="setModeAndConvert('toLiteral')"><span>â¬‡ï¸</span> æ¢è¡Œè½¬ \n</button>
                <button id="btnToReal" class="btn btn-default" onclick="setModeAndConvert('toReal')"><span>â¬†ï¸</span> \n è½¬æ¢è¡Œ</button>
            </div>
            
            <textarea id="inputText" class="common-textarea-style" placeholder="åœ¨æ­¤è¾“å…¥æ–‡æœ¬ã€‚é€‰ä¸­éƒ¨åˆ†æ–‡å­—åï¼Œç‚¹å‡»â€œé¢œè‰²æ ‡ç­¾â€æŒ‰é’®ã€‚"></textarea>
        </div>
        
        <div class="footer-toolbar">
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-default" onclick="loadExample()">ğŸ“„ åŠ è½½æ ·ä¾‹</button>
                <button class="btn btn-default" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰</button>
            </div>
        </div>
    </div>
    
    <div class="panel output-panel">
        <div class="header">
            <h1>ç»“æœé¢„è§ˆ (Result)</h1>
        </div>
        
        <div class="editor-box">
             <div class="top-toolbar" style="border-bottom: none;">
                <div class="flex-spacer"></div>
                <button id="btnToggleView" class="btn btn-default" onclick="toggleView()">
                    ğŸ‘ï¸ é¢„è§ˆæ•ˆæœ
                </button>
                <button class="btn btn-primary" onclick="copyResult()">ğŸ“‹ å¤åˆ¶ç»“æœä»£ç </button>
            </div>

            <div class="output-container" id="outputContainer">
                <textarea id="outputText" class="common-textarea-style" readonly placeholder="è½¬æ¢ç»“æœä»£ç æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                <div id="outputPreview" class="common-textarea-style"></div>
            </div>
        </div>
    </div>
</div>

<div id="colorConfirmModal">
    <div class="modal-content">
        <h3 style="margin: 0; font-size: 1.2rem; font-weight: 500;">é€‰æ‹©æ–‡æœ¬é¢œè‰²</h3>
        <div class="color-group" style="align-self: flex-start; margin-top: 5px;">
            <label for="modalHexInput" style="font-weight: 400; color: var(--text-main);">#</label>
            <input type="text" id="modalHexInput" maxlength="6" value="773131" placeholder="RRGGBB">
            <input type="color" id="modalColorPicker" value="#773131">
        </div>
        
        <div class="modal-actions">
            <button class="btn btn-default" onclick="hideColorModal()">å–æ¶ˆ</button>
            <button class="btn btn-primary" onclick="confirmColor()">ç¡®è®¤åº”ç”¨</button>
        </div>
    </div>
</div>

<div id="toast">æç¤ºæ¶ˆæ¯</div>

<script>
    const inputEl = document.getElementById('inputText');
    const outputEl = document.getElementById('outputText');
    const outputPreviewEl = document.getElementById('outputPreview');
    const outputContainer = document.getElementById('outputContainer');
    const btnColor = document.getElementById('btnColor');
    const btnToLiteral = document.getElementById('btnToLiteral');
    const btnToReal = document.getElementById('btnToReal');
    const btnToggleView = document.getElementById('btnToggleView');
    const modal = document.getElementById('colorConfirmModal');
    const modalHexInput = document.getElementById('modalHexInput');
    const modalColorPicker = document.getElementById('modalColorPicker');
    const toastEl = document.getElementById('toast');

    let isPreviewMode = false;
    let currentConversionMode = 'toReal'; // é»˜è®¤æ¨¡å¼æ˜¯ï¼šæŠŠ \n è½¬æ¢æˆå®é™…æ¢è¡Œ

    // --- 1. æ ¸å¿ƒè½¬æ¢ä¸é«˜äº®é€»è¾‘ ---

    /**
     * è®¾ç½®è½¬æ¢æ¨¡å¼å¹¶è§¦å‘è½¬æ¢
     * @param {string} mode 'toLiteral' (æ¢è¡Œè½¬ \n) or 'toReal' (\n è½¬æ¢è¡Œ)
     */
    function setModeAndConvert(mode) {
        currentConversionMode = mode;
        updateModeHighlight();
        convert();
    }
    
    /**
     * å®æ—¶è½¬æ¢è¾“å…¥æ¡†å†…å®¹åˆ°è¾“å‡ºæ¡†
     */
    function convert() {
        const raw = inputEl.value;
        if (!raw && currentConversionMode) { outputEl.value = ''; updatePreview(); return; }

        let result = raw;
        if (currentConversionMode === 'toLiteral') {
            // æ¢è¡Œè½¬ \n
            result = raw.replace(/\r\n/g, '\\n').replace(/\n/g, '\\n');
        } else if (currentConversionMode === 'toReal') {
            // \n è½¬æ¢è¡Œ
            result = raw.replace(/\\n/g, '\n');
        }
        
        outputEl.value = result;
        updatePreview();
    }

    /**
     * æ›´æ–°è½¬æ¢æ¨¡å¼æŒ‰é’®çš„é«˜äº®çŠ¶æ€
     */
    function updateModeHighlight() {
        // æ¸…é™¤æ‰€æœ‰é«˜äº®
        btnToLiteral.classList.remove('btn-active');
        btnToReal.classList.remove('btn-active');
        btnToLiteral.classList.add('btn-default');
        btnToReal.classList.add('btn-default');

        // è®¾ç½®å½“å‰æ¨¡å¼é«˜äº®
        if (currentConversionMode === 'toLiteral') {
            btnToLiteral.classList.add('btn-active');
            btnToLiteral.classList.remove('btn-default');
        } else if (currentConversionMode === 'toReal') {
            btnToReal.classList.add('btn-active');
            btnToReal.classList.remove('btn-default');
        }
    }

    // ç»‘å®šè¾“å…¥äº‹ä»¶å®ç°å®æ—¶æ˜¾ç¤º
    inputEl.addEventListener('input', convert);


    // --- 2. é¢„è§ˆæ¸²æŸ“é€»è¾‘ (ä¿æŒä¸å˜) ---

    function updatePreview() {
        if (!isPreviewMode) return; 
        const rawCode = outputEl.value;
        
        // 1. HTML è½¬ä¹‰
        let safeHTML = rawCode
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");

        // 2. å°†è‡ªå®šä¹‰ <color> æ ‡ç­¾è½¬æ¢ä¸º HTML span æ ‡ç­¾ (åŒ¹é…è¢«è½¬ä¹‰åçš„æ ‡ç­¾)
        safeHTML = safeHTML.replace(/&lt;color=(#[0-9a-fA-F]{3,6})&gt;(.*?)&lt;\/color&gt;/gs, function(match, colorHex, content) {
             const processedContent = content.replace(/\n/g, '<br>'); 
             return `<span style="color: ${colorHex};">${processedContent}</span>`;
        });
        
        // 3. å¤„ç†æœªè¢« <color> æ ‡ç­¾åŒ…è£¹çš„æ¢è¡Œ
        if (currentConversionMode === 'toReal') {
             safeHTML = safeHTML.replace(/\n/g, '<br>');
        }

        outputPreviewEl.innerHTML = safeHTML;
    }

    // --- 3. é¢œè‰²é€‰æ‹©ä¸åº”ç”¨é€»è¾‘ (ç•¥) ---
    // (é€»è¾‘ä¸ä¸Šä¸€ä¸ªç‰ˆæœ¬ç›¸åŒï¼Œä»…ä¿ç•™å…³é”®å‡½æ•°ç­¾å)

    function checkSelection() {
        const hasSelection = inputEl.selectionStart !== inputEl.selectionEnd;
        if (hasSelection) {
            btnColor.classList.remove('btn-disabled');
            btnColor.disabled = false;
        } else {
            btnColor.classList.add('btn-disabled');
            btnColor.disabled = true;
        }
    }
    inputEl.addEventListener('mouseup', checkSelection);
    inputEl.addEventListener('keyup', checkSelection);
    inputEl.addEventListener('input', checkSelection); // å®æ—¶æ›´æ–°æŒ‰é’®çŠ¶æ€

    function showColorModal() {
        if (btnColor.disabled) return;
        const selectedColor = modalColorPicker.value.toUpperCase();
        modalHexInput.value = selectedColor.substring(1);
        modal.classList.add('show');
    }

    function hideColorModal() {
        modal.classList.remove('show');
    }

    modalHexInput.addEventListener('input', function() {
        let hex = this.value.toUpperCase().replace(/[^0-9A-F]/g, '');
        if (hex.length >= 3) {
            modalColorPicker.value = '#' + hex.substring(0, 6);
        }
    });

    modalColorPicker.addEventListener('input', function() {
        modalHexInput.value = this.value.substring(1).toUpperCase();
    });

    function confirmColor() {
        const hex = modalColorPicker.value.toUpperCase(); 
        hideColorModal();
        applyColorTag(hex);
    }

    function applyColorTag(hex) {
        const start = inputEl.selectionStart;
        const end = inputEl.selectionEnd;
        if (start === end) return;

        const text = inputEl.value;
        const selectedText = text.substring(start, end);
        const before = text.substring(0, start);
        const after = text.substring(end);
        
        const openTag = `<color=${hex}>`; 
        const closeTag = `</color>`;

        const newText = `${before}${openTag}${selectedText}${closeTag}${after}`;
        inputEl.value = newText;

        const newCursorPos = end + openTag.length + closeTag.length;
        inputEl.setSelectionRange(newCursorPos, newCursorPos);
        inputEl.focus();
        
        // ä½¿ç”¨ convert() è‡ªåŠ¨è§¦å‘å®æ—¶æ›´æ–°
        convert();
        checkSelection(); 
        showToast('âœ… é¢œè‰²æ ‡ç­¾å·²åº”ç”¨');
    }
    
    // --- 4. æ’å…¥ \n é€»è¾‘ (ä¿æŒä¸å˜) ---
    function insertNewline() {
        const text = inputEl.value;
        const cursorPosition = inputEl.selectionStart; 

        const newText = text.substring(0, cursorPosition) + '\\n' + text.substring(cursorPosition);
        inputEl.value = newText;

        const newCursorPosition = cursorPosition + 2; 
        inputEl.setSelectionRange(newCursorPosition, newCursorPosition);
        inputEl.focus();
        
        convert(); // å®æ—¶æ›´æ–°
        showToast('â†©ï¸ å·²æ’å…¥ \\n ç¬¦å·');
    }

    // --- 5. è§†å›¾ä¸é€šç”¨åŠŸèƒ½ ---

    function toggleView() {
        isPreviewMode = !isPreviewMode;
        if (isPreviewMode) {
            outputContainer.classList.add('preview-mode');
            btnToggleView.innerHTML = 'ğŸ“ æ˜¾ç¤ºä»£ç ';
            btnToggleView.classList.add('btn-primary');
            btnToggleView.classList.remove('btn-default');
            updatePreview(); 
        } else {
            outputContainer.classList.remove('preview-mode');
            btnToggleView.innerHTML = 'ğŸ‘ï¸ é¢„è§ˆæ•ˆæœ';
            btnToggleView.classList.remove('btn-primary');
            btnToggleView.classList.add('btn-default');
        }
    }

    function loadExample() {
        inputEl.value = "è¿™æ˜¯ç¬¬ä¸€è¡Œæ–‡æœ¬\né€‰ä¸­æˆ‘ï¼Œç‚¹å‡»é¢œè‰²æŒ‰é’®ï¼š(å½©è‰²æ–‡æœ¬)\n\nä¸‹æ–¹æ˜¯å­—é¢é‡æ¢è¡Œç¬¦çš„ç¤ºä¾‹ï¼š\n123\\n456\\n789";
        convert(); // å®æ—¶æ›´æ–°
        showToast('å·²åŠ è½½æ ·ä¾‹');
    }

    function clearAll() {
        inputEl.value = '';
        outputEl.value = '';
        outputPreviewEl.innerHTML = '';
        inputEl.focus();
        checkSelection();
        showToast('å·²æ¸…ç©º');
    }

    function copyResult() {
        if (!outputEl.value) { showToast('ç»“æœä¸ºç©º'); return; }
        outputEl.select();
        outputEl.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(outputEl.value).then(() => {
            showToast('âœ… å·²å¤åˆ¶åŸå§‹ä»£ç  (åŒ…å«æ ‡ç­¾)');
        }).catch(() => {
            showToast('âŒ å¤åˆ¶å¤±è´¥');
        });
    }

    let toastTimeout;
    function showToast(msg) {
        toastEl.textContent = msg; toastEl.classList.add('show');
        clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => { toastEl.classList.remove('show'); }, 2500);
    }

    // åˆå§‹åŒ–ï¼šè®¾ç½®é»˜è®¤æ¨¡å¼ï¼Œæ›´æ–°é«˜äº®ï¼Œå¹¶æ‰§è¡Œç¬¬ä¸€æ¬¡è½¬æ¢
    function initialize() {
        // é»˜è®¤æ¨¡å¼ï¼š\n è½¬æ¢è¡Œ (toReal)
        setModeAndConvert('toReal'); 
        // é»˜è®¤è§†å›¾ï¼šæ˜¾ç¤ºä»£ç æ¨¡å¼
        toggleView(); 
        checkSelection();
    }

    initialize();
</script>

</body>
</html>